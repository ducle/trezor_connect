services:
  # cache context
  cache_context.trezor_connect_challenge:
    class: Drupal\trezor_connect\Cache\Context\TrezorConnectChallengeCacheContext
    arguments: ['@trezor_connect.challenge_manager']
    tags:
      - { name: cache.context}
  # cache tables
  #cache.trezor_connect_challenges:
  #  class: Drupal\Core\Cache\CacheBackendInterface
  #  tags:
  #    - { name: cache.bin }
  #  factory: cache_factory:get
  #  arguments: ['trezor_connect_challenges']
  # challenge services
  trezor_connect.challenge:
    class: Drupal\trezor_connect\Challenge\Challenge
  trezor_connect.challenge_manager:
    class: Drupal\trezor_connect\Challenge\ChallengeManager
    arguments: ['@session', '@trezor_connect.challenge']
  # challenge response services
  trezor_connect.challenge_response:
    class: Drupal\trezor_connect\Challenge\ChallengeResponse
  trezor_connect.challenge_response_manager:
    class: Drupal\trezor_connect\Challenge\ChallengeResponseManager
    arguments: ['@session', '@request_stack', '@trezor_connect.challenge_response']
  # challenge validator service
  trezor_connect.challenge_validator:
    class: Drupal\trezor_connect\Challenge\ChallengeValidator
  # mapping services
  trezor_connect.mapping_manager_factory:
    class: Drupal\trezor_connect\Mapping\MappingManagerFactory
    arguments: ['@settings', '@config.factory', '%trezor_connect_mapping_backends%', '%trezor_connect_mapping_backend%', '@trezor_connect.challenge_manager', '@trezor_connect.challenge_response_manager', '@cache_tags.invalidator']
    calls:
      - [setContainer, ['@service_container']]
  trezor_connect.mapping_manager:
    class: Drupal\trezor_connect\Mapping\MappingManager
    factory: trezor_connect.mapping_manager_factory:get
  trezor_connect.mappings.backend.database:
    class: Drupal\trezor_connect\Mapping\MappingBackendDatabase
    arguments: ['@database', '@cache_tags.invalidator.checksum']
    tags:
      - { name: trezor_connect_mapping_backend, title: 'Database', priority: 0, default: 1 }
  # helper service
  trezor_connect:
    class: Drupal\trezor_connect\TrezorConnect
    arguments: ['@session', '@config.factory', '@trezor_connect.challenge_manager', '@trezor_connect.challenge_response_manager', '@trezor_connect.mapping_manager', '%trezor_connect_mapping_backends%', '%trezor_connect_mapping_backend%']
